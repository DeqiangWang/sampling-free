from maskrcnn_benchmark.config import cfg
from predictor import COCODemo
import cv2
import os

# what's need to be set
detdir="backup/36.5ap_retinanet_R_50_FPN_1x_freex1.0"
network="retinanet_R_50_FPN"
config="config.yml"
weight="model_final.pth"
imgdir="datasets/coco/val2017/"
outdir=detdir+"/visout"
# --- faster_rcnn ---
#thresh=[0.5976296067237854, 0.6221904158592224, 0.6066722273826599, 0.6140303015708923, 0.7266175746917725, 0.6605913043022156, 0.6800294518470764, 0.48198097944259644, 0.5781968832015991, 0.6049327254295349, 0.7579079270362854, 0.767076313495636, 0.7717408537864685, 0.5259188413619995, 0.4421078562736511, 0.787499725818634, 0.7433050870895386, 0.6492013335227966, 0.6069155335426331, 0.5619597434997559, 0.6840936541557312, 0.6499082446098328, 0.7380648255348206, 0.800866425037384, 0.4603075385093689, 0.6000152826309204, 0.3462649881839752, 0.5408627390861511, 0.4830876886844635, 0.603275716304779, 0.4751516282558441, 0.5852627158164978, 0.7859720587730408, 0.5431862473487854, 0.6204991340637207, 0.6934318542480469, 0.782996416091919, 0.6697094440460205, 0.6063173413276672, 0.6113305687904358, 0.576166570186615, 0.6113216280937195, 0.4702640175819397, 0.4206956624984741, 0.42982208728790283, 0.5852066874504089, 0.4576174020767212, 0.4086095690727234, 0.5050305724143982, 0.44399645924568176, 0.48731788992881775, 0.5916339159011841, 0.6894081234931946, 0.6194762587547302, 0.44872725009918213, 0.41333693265914917, 0.6136869788169861, 0.6119310855865479, 0.5344784259796143, 0.5464360117912292, 0.5658395290374756, 0.6687880158424377, 0.6554551720619202, 0.6502977609634399, 0.6499885320663452, 0.6516026258468628, 0.7400603890419006, 0.6622065901756287, 0.648192286491394, 0.623454213142395, 0.32343730330467224, 0.6992748379707336, 0.7755551338195801, 0.4202946722507477, 0.7287189960479736, 0.6416608691215515, 0.6735117435455322, 0.6809283494949341, 0.05788514390587807, 0.5038005709648132]
# Maximum f-measures for classes: 0.612014908417468 
#[0.7904619095739478, 0.6096347875515135, 0.6744222022833452, 0.7119189624159803, 0.818253654681944, 0.772387025228722, 0.7935639581657281, 0.5418089728398504, 0.539216464301775, 0.5879128408935179, 0.8400803904679873, 0.7500000000000001, 0.6451612903225806, 0.40711175616835993, 0.6127668569012893, 0.8498621663416931, 0.7686397764972935, 0.7569698676429176, 0.7070456258590875, 0.7272421052631579, 0.8235482322828348, 0.8053388090349075, 0.8654139156932453, 0.8661623343382061, 0.3780385582564963, 0.6057206954570947, 0.346676930972543, 0.5666341463414634, 0.5921787709497207, 0.8106221906789685, 0.48651738923296806, 0.5176370590735232, 0.6795212765957447, 0.6290393493075401, 0.5683491062039958, 0.6332815946409608, 0.757197175448126, 0.633854124504169, 0.734717416378316, 0.5998344612688057, 0.5916981132075471, 0.5694854837953193, 0.5306990881458966, 0.36346948141349245, 0.3760941744642319, 0.5737530413625304, 0.4736842105263158, 0.3667167059832726, 0.5073301950235374, 0.4748712919833292, 0.4786897806723494, 0.4377811094452774, 0.4924060751398881, 0.6922864421866847, 0.6115565701241261, 0.5433702000745619, 0.4733730919790873, 0.6293082072898588, 0.533414438576603, 0.6066886481394255, 0.47631374579342484, 0.7590009730781706, 0.7229454608017435, 0.7626348665530949, 0.7819464033850494, 0.499609436025621, 0.6882793017456359, 0.5625754138713258, 0.7172413793103448, 0.5570131180625632, 0.5689655172413792, 0.606217616580311, 0.7113884555382216, 0.41669136127665646, 0.7377690802348337, 0.5650745914289107, 0.4989339019189766, 0.696353884761108, 0.07659574468085106, 0.4242219215155616]
#sampling-free
thresh=[0.4371891915798187, 0.46171146631240845, 0.5296061635017395, 0.5234315395355225, 0.6229737401008606, 0.6159636974334717, 0.5512601137161255, 0.4265977144241333, 0.42164909839630127, 0.32164695858955383, 0.5077733397483826, 0.48619964718818665, 0.4607727825641632, 0.3979570269584656, 0.30369892716407776, 0.8135490417480469, 0.6829183101654053, 0.6080967783927917, 0.5646070837974548, 0.5108886957168579, 0.5808590054512024, 0.6741905808448792, 0.5291958451271057, 0.7154825329780579, 0.312383234500885, 0.4740469455718994, 0.2626843750476837, 0.5280243754386902, 0.3422350585460663, 0.41298380494117737, 0.3977590799331665, 0.6102864742279053, 0.43889352679252625, 0.4054335653781891, 0.4392525255680084, 0.6822248697280884, 0.603229820728302, 0.6460747122764587, 0.46949824690818787, 0.4644516110420227, 0.2812917232513428, 0.5096933841705322, 0.4845949411392212, 0.2746976315975189, 0.3786146640777588, 0.49565809965133667, 0.21601426601409912, 0.17973321676254272, 0.5384898781776428, 0.41497695446014404, 0.2650012969970703, 0.3929654359817505, 0.3357928991317749, 0.5104294419288635, 0.3789357542991638, 0.40750375390052795, 0.3915923535823822, 0.35797908902168274, 0.4620027244091034, 0.544791042804718, 0.3700826168060303, 0.6745416522026062, 0.4788873791694641, 0.6247454881668091, 0.46333834528923035, 0.411349892616272, 0.5047735571861267, 0.44768038392066956, 0.5440098643302917, 0.4872834384441376, 0.2711447775363922, 0.5400491952896118, 0.5257142782211304, 0.22978432476520538, 0.5204148888587952, 0.4382551610469818, 0.442573219537735, 0.5920896530151367, 0.056038372218608856, 0.7017887830734253]
# Maximum f-measures for classes: 0.6195230933847523
#[0.7938071780436313, 0.624557219513906, 0.6834046709373474, 0.7206516530905606, 0.8463661453541859, 0.7878446820483963, 0.8114161287813982, 0.5594302099713255, 0.570281124497992, 0.5794716981132075, 0.8544004326078141, 0.7532994923857869, 0.6521040796659171, 0.41089494163424123, 0.6035011534807979, 0.8749758950954555, 0.7563559322033899, 0.749804918932979, 0.7027849286215775, 0.7369558441558441, 0.8338493292053664, 0.8128023818384816, 0.866216471477144, 0.8683262183289905, 0.38839095177123345, 0.6298568507157465, 0.337768679631525, 0.5959367945823928, 0.5988909426987061, 0.8034934497816594, 0.5307140629872155, 0.5619690699194074, 0.6624203821656051, 0.6274429008712032, 0.5581395348837209, 0.6554477144646211, 0.780185758513932, 0.6397483849030942, 0.7611940298507464, 0.5946160515622225, 0.6080922496045715, 0.5773561068655015, 0.5470941883767535, 0.3785563131906889, 0.3480940794809408, 0.6027857354539169, 0.470135096292038, 0.38487170943018995, 0.5080500894454383, 0.46357615894039733, 0.4931614349775785, 0.4296081277213353, 0.5045871559633027, 0.7039367774037758, 0.5877842411422527, 0.5597748501040095, 0.4813308687615526, 0.6117433414043584, 0.4939438700147711, 0.6742535487028879, 0.4781594175844689, 0.7590361445783133, 0.7323648514711295, 0.7855905784551438, 0.772978402812657, 0.5177664974619289, 0.6965781770465328, 0.5610278372591005, 0.7101669195751139, 0.573208722741433, 0.597285067873303, 0.6116423730387152, 0.725170068027211, 0.4017825086063063, 0.7497112052368118, 0.5686778863820093, 0.4804928131416838, 0.6955033748455176, 0.10465116279069767, 0.4315992292870906]

# --- retinanet ---
# thresh=[0.3694014847278595, 0.4571536183357239, 0.39656537771224976, 0.41244441270828247, 0.5056858062744141, 0.4350004494190216, 0.5713338255882263, 0.39189574122428894, 0.341508686542511, 0.35540008544921875, 0.5524955987930298, 0.5317039489746094, 0.5077581405639648, 0.396236389875412, 0.34352728724479675, 0.5322204828262329, 0.5403727293014526, 0.5216498970985413, 0.4584203362464905, 0.40391823649406433, 0.4791758060455322, 0.6555728316307068, 0.4114493429660797, 0.566618025302887, 0.32816237211227417, 0.3699288070201874, 0.30228981375694275, 0.38826414942741394, 0.36540549993515015, 0.45482635498046875, 0.28245535492897034, 0.38001877069473267, 0.4042949676513672, 0.3513512909412384, 0.32907822728157043, 0.45699551701545715, 0.4247482120990753, 0.46436116099357605, 0.54253751039505, 0.35505035519599915, 0.3578009009361267, 0.37758275866508484, 0.3210687041282654, 0.329647034406662, 0.3106987476348877, 0.4076959192752838, 0.3440468907356262, 0.3018497824668884, 0.3774559497833252, 0.3201582133769989, 0.342082142829895, 0.3315456807613373, 0.41737955808639526, 0.4508129358291626, 0.2849199175834656, 0.3464793860912323, 0.36234328150749207, 0.3290613293647766, 0.38464033603668213, 0.39867597818374634, 0.40267208218574524, 0.5268617868423462, 0.5148425698280334, 0.47894659638404846, 0.5471668243408203, 0.40796002745628357, 0.3937344253063202, 0.4912357032299042, 0.5383867621421814, 0.48571404814720154, 0.3130236268043518, 0.3598102927207947, 0.402205228805542, 0.2663772702217102, 0.49954771995544434, 0.39031434059143066, 0.44924211502075195, 0.47379598021507263, 0.18940268456935883, 0.3338594138622284]
# Maximum f-measures for classes: 0.5854631532055212
# [0.7707214986345888, 0.5594584705451885, 0.6436163324667046, 0.6817480719794344, 0.8402423776089257, 0.7664370695053224, 0.7972078038303204, 0.5320696495481596, 0.504327416752237, 0.5508315147866656, 0.8230504227998747, 0.7441860465116279, 0.6231253023705854, 0.39658848614072495, 0.5758037870123269, 0.8742559755679518, 0.8029549651939196, 0.7354962442064887, 0.6780742608650902, 0.7290448343079923, 0.8094218415417558, 0.8500414250207126, 0.8594789616718209, 0.839454290760704, 0.3495672393747578, 0.5979131278815821, 0.32861394676086897, 0.5153374233128833, 0.5639097744360902, 0.7575304144167587, 0.45463449381177096, 0.40857931620301546, 0.6566013491808546, 0.6150605885747258, 0.4933426769446391, 0.6033566669477946, 0.7274640477025606, 0.5419045444165335, 0.7559055118110237, 0.5581704308217879, 0.5747899159663865, 0.5668569289791335, 0.4387755102040816, 0.3125441945976524, 0.30019749835418036, 0.5553894150006461, 0.4727941820730746, 0.34971428571428576, 0.5007202535292423, 0.4568651275820171, 0.4618192881046547, 0.378404204491161, 0.45389630549518784, 0.6786494678226546, 0.576682789197904, 0.5230520734576355, 0.45499759345419544, 0.5737514518002322, 0.48949320148331277, 0.6172977817611472, 0.46959459459459457, 0.7616521409624859, 0.7236567553468962, 0.7413901064495929, 0.764774044032445, 0.4778145695364238, 0.614372353816226, 0.5488224995764387, 0.7412437455325233, 0.5620437956204379, 0.4422110552763819, 0.5454545454545454, 0.6819258089976322, 0.360033912142431, 0.7327850235727313, 0.5383104125736738, 0.44974446337308355, 0.6483694234281242, 0.04072398190045248, 0.33990895295902884]
# sampling-free
thresh=[0.4904730021953583, 0.6648799180984497, 0.543845534324646, 0.595219612121582, 0.7768734693527222, 0.6444670557975769, 0.8926939964294434, 0.4436971843242645, 0.3920714855194092, 0.46329888701438904, 0.7514716982841492, 0.9741511940956116, 0.7453244924545288, 0.391315758228302, 0.5226143002510071, 0.8205378651618958, 0.844495415687561, 0.5237988233566284, 0.6930292248725891, 0.5319238901138306, 0.8131843209266663, 0.7063014507293701, 0.8300617933273315, 0.9373629093170166, 0.3696623146533966, 0.4474036991596222, 0.3742661476135254, 0.39578554034233093, 0.35302820801734924, 0.7647333145141602, 0.24358144402503967, 0.5204253792762756, 0.6446276307106018, 0.3758046627044678, 0.6459153294563293, 0.4027022421360016, 0.6692474484443665, 0.6291502118110657, 0.7759312987327576, 0.38982462882995605, 0.4637743830680847, 0.3727092146873474, 0.3174211084842682, 0.45569151639938354, 0.3313935101032257, 0.5346291065216064, 0.30662861466407776, 0.365543395280838, 0.5866125822067261, 0.5038711428642273, 0.4365164339542389, 0.45154401659965515, 0.509432852268219, 0.705413818359375, 0.39023280143737793, 0.4709616005420685, 0.4971652626991272, 0.5272958278656006, 0.6350900530815125, 0.5934302806854248, 0.49212828278541565, 0.7931073904037476, 0.7161775231361389, 0.6700578331947327, 0.8444267511367798, 0.6034513115882874, 0.3947305977344513, 0.6147414445877075, 0.5751606822013855, 0.47014930844306946, 0.2992693781852722, 0.43546634912490845, 0.6658596992492676, 0.230497807264328, 0.8362297415733337, 0.5887297987937927, 0.5538510680198669, 0.8041126728057861, 0.03896114230155945, 0.3218655586242676]
# Maximum f-measures for classes: 0.5843449338313405 
# [0.7588169246968856, 0.5812349639133921, 0.6437586402378987, 0.7011961182577297, 0.8151938594764809, 0.7621419676214197, 0.7828297091217171, 0.5302937308198158, 0.5103919239904988, 0.5413051459931594, 0.8251107377424775, 0.7221279003961516, 0.614298323036187, 0.3913884233595462, 0.5702560735390676, 0.8571607411116676, 0.7735644637053088, 0.7142338605133524, 0.6934606205250596, 0.6845433847710599, 0.8006145067486009, 0.8554260742898763, 0.8433497536945812, 0.849662975445354, 0.35848899958489, 0.6057772145260675, 0.3575765404986435, 0.5378895184135978, 0.5562913907284769, 0.7449219585204191, 0.4734679450360094, 0.39543057996485065, 0.663872590108969, 0.6201469045120671, 0.49102973703612685, 0.5836260470143204, 0.7222222222222223, 0.5498834992586317, 0.7688442211055276, 0.5580901960021022, 0.5656913367756742, 0.5679383061489116, 0.4523529740921045, 0.31901840490797545, 0.3127823932371374, 0.5645658190172835, 0.4764962442452145, 0.35638921453692846, 0.4915017653337712, 0.4471059744617393, 0.4573982125124131, 0.39247510143858355, 0.4615384615384615, 0.6723418687468204, 0.5725992317541614, 0.561710471737245, 0.46581615963362777, 0.592814371257485, 0.5072240034833552, 0.6213351375732973, 0.4866975130133025, 0.7521758241758242, 0.7489568276652032, 0.7374924546390655, 0.7751405371642723, 0.47108039287013465, 0.6176797627872499, 0.5618729096989967, 0.7233103448275863, 0.5590929569004355, 0.3316582914572864, 0.5380240344922484, 0.6735598227474151, 0.35834474662492666, 0.7268874920545236, 0.5447316103379721, 0.41838351822503955, 0.6623922175547203, 0.03837953091684435, 0.3527180783817952]

# --- mask_rcnn ---
#baseline_thresh = [0.6009693145751953, 0.6766153573989868, 0.6748730540275574, 0.5851236581802368, 0.8067564368247986, 0.6829034090042114, 0.6540001034736633, 0.42086920142173767, 0.6310264468193054, 0.576596736907959, 0.7182245850563049, 0.8081580400466919, 0.8449401259422302, 0.5791822671890259, 0.476797878742218, 0.7098460793495178, 0.5903158187866211, 0.7720410823822021, 0.7110618352890015, 0.47929781675338745, 0.737158477306366, 0.8458963632583618, 0.7947010397911072, 0.814479649066925, 0.44098997116088867, 0.5322158336639404, 0.41824302077293396, 0.6017897129058838, 0.4245312213897705, 0.6012450456619263, 0.5555493235588074, 0.7180959582328796, 0.8603506088256836, 0.5177062153816223, 0.5682739019393921, 0.6953546404838562, 0.7728491425514221, 0.48887258768081665, 0.7383052110671997, 0.5972691178321838, 0.5702030658721924, 0.6619213223457336, 0.39320287108421326, 0.5086840987205505, 0.47394871711730957, 0.5428017973899841, 0.3993377685546875, 0.43173208832740784, 0.5753902196884155, 0.5041504502296448, 0.5363325476646423, 0.5817720890045166, 0.699409008026123, 0.6435895562171936, 0.32349860668182373, 0.5820318460464478, 0.5477358102798462, 0.5836631059646606, 0.5132163763046265, 0.5897954106330872, 0.6419715881347656, 0.6746179461479187, 0.6194209456443787, 0.6327039003372192, 0.6144891977310181, 0.5837699770927429, 0.6752408742904663, 0.6771562695503235, 0.7430931925773621, 0.5378075242042542, 0.5998000502586365, 0.6449807286262512, 0.749815046787262, 0.4008117616176605, 0.7942065596580505, 0.642356812953949, 0.6166144013404846, 0.6440011262893677, 0.07464557141065598, 0.41135841608047485]
# its f1-score: 0.5965259672177909
# [0.7782656176870446, 0.4936831875607387, 0.6619157968131575, 0.6609161213563355, 0.8149444215726637, 0.7715654952076678, 0.7867283458286808, 0.538659793814433, 0.5158620689655172, 0.577622189309277, 0.8652308578837429, 0.7500000000000001, 0.6521739130434783, 0.37230357060372304, 0.578854105138807, 0.8825194621372966, 0.7977552341895101, 0.7227926078028748, 0.6845208717562408, 0.6924850376097436, 0.8215794257605732, 0.8438037865748709, 0.8715534633490248, 0.8621089223638472, 0.38209913706602444, 0.6512956539481739, 0.3498920086393088, 0.5719913334646444, 0.5989672977624785, 0.7925750303591048, 0.23344017094017094, 0.48198464264619023, 0.6483790523690773, 0.5861424250756119, 0.5527084009082064, 0.6079523174652969, 0.6936800725733293, 0.584571343961305, 0.7685802239437095, 0.593743000074666, 0.5634264315805898, 0.5824114969542256, 0.42880673499267935, 0.30347448425624324, 0.31816160118606374, 0.5587512150494596, 0.4425433377287492, 0.35282006826678225, 0.488214664383003, 0.482670906200318, 0.48940823187648924, 0.39535901926444833, 0.46119873817034707, 0.6928876848255378, 0.6110228211811075, 0.5736398816298658, 0.43516879934658315, 0.5936820049963736, 0.5165859112933284, 0.6236220472440945, 0.36813611755607123, 0.7714443829551743, 0.7370658165637245, 0.7527018436109345, 0.8076620309630018, 0.5316746073760368, 0.7095115681233933, 0.5253190613421161, 0.7249712313003452, 0.5677950252478026, 0.5301204819277109, 0.5809768637532133, 0.704791344667697, 0.3086083915207281, 0.7523148148148149, 0.5731462925851702, 0.5105566218809982, 0.6647230320699709, 0.24884792626728108, 0.3420074349442379]

# sampling-free: 0.624778578086193
#free_thresh = [0.40836647152900696, 0.5883768796920776, 0.4973059892654419, 0.49787023663520813, 0.6815237402915955, 0.6421763300895691, 0.5636156797409058, 0.386392742395401, 0.3138643503189087, 0.4242801368236542, 0.8023367524147034, 0.5749799013137817, 0.7088608145713806, 0.39975133538246155, 0.22852887213230133, 0.5815382599830627, 0.6750882267951965, 0.7208858132362366, 0.588912844657898, 0.6456626653671265, 0.36632248759269714, 0.7442012429237366, 0.7743787169456482, 0.8392951488494873, 0.3089240789413452, 0.3142017126083374, 0.1881052851676941, 0.3773036301136017, 0.41472935676574707, 0.3856079876422882, 0.4522726237773895, 0.5759906768798828, 0.4667891263961792, 0.39420583844184875, 0.6828474998474121, 0.39770960807800293, 0.6465439796447754, 0.5216158032417297, 0.4614114463329315, 0.4713174104690552, 0.3299848437309265, 0.546069860458374, 0.35830578207969666, 0.33639955520629883, 0.4392954409122467, 0.5412867069244385, 0.2150624394416809, 0.17846502363681793, 0.46047836542129517, 0.2735828757286072, 0.43467092514038086, 0.4543546140193939, 0.3828335702419281, 0.563357949256897, 0.4177246689796448, 0.4307236969470978, 0.35901737213134766, 0.3806508779525757, 0.3854299485683441, 0.3950069844722748, 0.4102804362773895, 0.5778281688690186, 0.5814635753631592, 0.7484567761421204, 0.5120485424995422, 0.3864794969558716, 0.3273776173591614, 0.48768582940101624, 0.6405259370803833, 0.4430214464664459, 0.382080078125, 0.6818448901176453, 0.5987183451652527, 0.19766078889369965, 0.4662286937236786, 0.5517673492431641, 0.49106281995773315, 0.568229615688324, 0.04861709848046303, 0.5030775666236877]
# its f1-score
# [0.7998848849877691, 0.6144200626959248, 0.6812935157995826, 0.7297774958082204, 0.8372434735759416, 0.7830241708825183, 0.8002050392334686, 0.5513792679427798, 0.56490727532097, 0.5931969026548672, 0.8475836431226765, 0.7445255474452556, 0.631578947368421, 0.43873775843307955, 0.6204986149584488, 0.8728018924387949, 0.7848909873628662, 0.7793331330729949, 0.7097215437225208, 0.7309961818812913, 0.8340931438276571, 0.843403205918619, 0.8760925449871466, 0.868144690781797, 0.385511544164372, 0.6422145328719724, 0.35391988425716614, 0.6206681236340931, 0.6074404761904761, 0.812473925740509, 0.5371344414054282, 0.5574370709382152, 0.6829079387431789, 0.6634942216179469, 0.5766283524904214, 0.6354350123282846, 0.7614131885734626, 0.6430418250950571, 0.7431593638667499, 0.6045846443018837, 0.6054910933159012, 0.5795601552393274, 0.5336185819070904, 0.3754512635379062, 0.3617057138041463, 0.6031735116642886, 0.45559260381933925, 0.36029853307025816, 0.522235576923077, 0.46255629756173317, 0.46613669671803526, 0.4213346730302269, 0.5685872462579455, 0.7175891391914069, 0.5795053003533569, 0.5729553709347472, 0.4933287482806052, 0.6263407333499625, 0.5213414634146342, 0.656970704342406, 0.4849762783342119, 0.7652001977261492, 0.726948245092207, 0.7762744804903572, 0.7996882307092751, 0.5217391304347826, 0.6956588316361688, 0.5887640449438202, 0.777115987460815, 0.5603112840466925, 0.6626506024096386, 0.5950413223140497, 0.7306465642215134, 0.40729452229733176, 0.7449139280125197, 0.5732217573221757, 0.4672566371681416, 0.6854037848978827, 0.09473684210526315, 0.47547169811320755]

config_file=detdir+"/"+config
weight_file=detdir+"/"+weight
#update the config options with the config file
cfg.merge_from_file(config_file)
# manual override some options
cfg.merge_from_list(["MODEL.DEVICE", "cuda"])
cfg.merge_from_list(["TEST_ON", True])
cfg.merge_from_list(["TEST.IMS_PER_BATCH", 1])
cfg.merge_from_list(["MODEL.WEIGHT", weight_file])
cfg.merge_from_list(["NETWORK", network])

coco_demo = COCODemo(
    cfg,
    min_image_size=800,
    confidence_threshold=thresh,
)

if not os.path.exists(outdir):
    os.mkdir(outdir)
image_files = os.listdir(imgdir)
image_files = [imgdir + "/" + i for i in image_files]
# load image and then run prediction
for i, image_file in enumerate(image_files):
    predictions = coco_demo.run_on_opencv_image(cv2.imread(image_file))
    cv2.imwrite(outdir+"/"+str(i)+".jpg", predictions)
    if i % 100 == 0:
        print(str(i) + " images finished...")
